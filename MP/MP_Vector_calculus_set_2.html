<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Physiquate Exam Portal</title>

<!-- Google Font and icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- ===== Modern Styles ===== -->
<style>
  /* Reset */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html,body { height: 100%; }

  body {
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#f8fafc 0%, #eef2f7 100%);
    color: #0f172a;
    line-height: 1.45;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Header */
  header {
    background: #1e3a8a;
    color: #fff;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    box-shadow: 0 4px 18px rgba(2,6,23,0.12);
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  .brand {
    display:flex;
    gap:12px;
    align-items:center;
  }
  .brand .logo {
    width: 60px;           /* adjust size as needed */
    height: 60px;          /* adjust size as needed */
    border-radius: 8px;    /* optional rounded corners */
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;      /* remove gradient background */
    box-shadow: none;      /* remove shadow if you donâ€™t want it */
    font-size: 0;          /* hides old icon text if any */
  }

  .brand .logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;   /* ensures image fits without stretching */
    border-radius: 8px;    /* keeps the corners rounded if desired */
  }
  .brand h1 { font-size:18px; font-weight:700; letter-spacing:0.2px; margin:0; }
  .brand p { font-size:12px; opacity:0.9; margin:0; }

  .header-right { display:flex; gap:12px; align-items:center; }
  .timer {
    background: rgba(255,255,255,0.08);
    padding: 6px 12px;
    border-radius: 8px;
    font-weight:600;
    display:flex; gap:8px; align-items:center;
  }
  .user-info { font-size:14px; color:rgba(255,255,255,0.95); }

  /* Main container */
  main {
    max-width: 1100px;
    margin: 28px auto;
    padding: 0 18px;
  }
  .exam-wrap {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 20px;
    align-items: start;
  }
  @media (max-width: 920px) {
    .exam-wrap { grid-template-columns: 1fr; }
  }

  /* Left panel (question card) */
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
  }
  .meta {
    display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px;
  }
  .meta .title { font-weight:600; color:#0f172a; }
  .meta .small { font-size:13px; color:#475569; }

  .question { font-size:18px; font-weight:600; margin-bottom:14px; color:#0b1220; }
  .options { margin-top:6px; }
  /* Option markup: we render <label><input><span class="opt-text"> text </span></label> */
  .options label {
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #e6edf6;
    margin-bottom:10px;
    cursor:pointer;
    transition: all 0.16s ease;
    background: #fbfdff;
  }
  .options label:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(16,24,40,0.04); border-color:#cfe3ff; }
  .options input[type="radio"] { width:18px; height:18px; accent-color:#1e3a8a; }
  .options .opt-text { flex:1; font-size:15px; color:#111827; }

  /* Highlight when checked: input:checked + .opt-text, and also style label background */
  .options input[type="radio"]:checked + .opt-text {
    font-weight:700;
    color:#0b1220;
  }
  /* To style label background when checked, use :has if supported, else we apply a small visual using sibling:
     Provide fallback: bright border on :checked. */
  /* Modern browsers: :has */
  @supports(selector(:has(*))) {
    .options label:has(input[type="radio"]:checked) {
      background: linear-gradient(90deg, rgba(219,234,254,0.35), rgba(235,241,255,0.5));
      border-color: #1e3a8a;
    }
  }
  /* Fallback for browsers without :has: style via checked + span (border on left) */
  .options input[type="radio"]:checked + .opt-text {
    outline: none;
    border-left: 4px solid #1e3a8a;
    padding-left:8px;
  }

  /* Right panel (summary, palette) */
  .side {
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .panel {
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 8px 20px rgba(2,6,23,0.04);
  }
  .progress {
    height:12px;
    background:#eef2ff;
    border-radius:999px;
    overflow:hidden;
  }
  .progress > i {
    display:block;
    height:100%;
    width:0%;
    background: linear-gradient(90deg,#2563eb,#1e3a8a);
    transition: width 300ms ease;
  }

  .palette {
    display:grid;
    grid-template-columns: repeat(5,1fr);
    gap:8px;
  }
  .pal-btn {
    padding:10px; border-radius:8px; border:1px solid #e2e8f0; text-align:center; font-weight:600; cursor:pointer;
    background:#fff;
  }
  .pal-btn.answered { background:#dcfce7; border-color:#bbf7d0; color:#165b2e; }
  .pal-btn.current { box-shadow: 0 6px 18px rgba(16,24,40,0.06); border-color:#93c5fd; }

  /* Controls bottom */
  .controls {
    display:flex; gap:10px; margin-top:14px; justify-content:space-between; align-items:center;
  }
  .controls .cta {
    background:#1e3a8a; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600;
  }
  #start-exam {
      background: #059669;           /* green like submit */
      color: #fff;
      border: none;
      padding: 10px 14px;            /* same size as submit */
      border-radius: 8px;            /* same rounded corners */
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;               /* ensure same text size */
      transition: all 0.16s ease;    /* smooth hover like submit */
  }
  #start-exam:hover {
      background: #047857;           /* slightly darker green on hover */
      transform: translateY(-2px);   /* subtle lift like other buttons */
      box-shadow: 0 6px 18px rgba(16,24,40,0.04);
  }
  #download-csv {
      background: #059669;           /* green like submit */
      color: #fff;
      border: none;
      padding: 10px 14px;            /* same size as submit */
      border-radius: 8px;            /* same rounded corners */
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;               /* ensure same text size */
      transition: all 0.16s ease;    /* smooth hover like submit */
  }
  #download-csv:hover {
      background: #047857;           /* slightly darker green on hover */
      transform: translateY(-2px);   /* subtle lift like other buttons */
      box-shadow: 0 6px 18px rgba(16,24,40,0.04);
  }
  .controls .muted { background:#f1f5f9; color:#334155; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }
  #home-btn {
        background: #059669;           /* green like submit */
        color: #fff;
        border: none;
        padding: 10px 14px;            /* same size as submit */
        border-radius: 8px;            /* same rounded corners */
        cursor: pointer;
        font-weight: 600;
        font-size: 15px;               /* ensure same text size */
        transition: all 0.16s ease;    /* smooth hover like submit */
    }
    #home-btn:hover {
        background: #047857;           /* slightly darker green on hover */
        transform: translateY(-2px);   /* subtle lift like other buttons */
        box-shadow: 0 6px 18px rgba(16,24,40,0.04);
    }
  /* Result table */
  .result-table { width:100%; border-collapse:collapse; margin-top:8px; font-size:14px; }
  .result-table th, .result-table td { padding:8px 10px; border:1px solid #e6eef9; text-align:left; }
  .result-table th { background:#f1f5f9; font-weight:600; }
  
  /* ===== Result Row Colors ===== */
  tr.correct-row {
  background-color: #e8f5e9; /* light green */
  }
  tr.incorrect-row {
    background-color: #ffebee; /* light red */
  }
  tr.unanswered-row {
    background-color:rgba(75, 78, 79, 0.2); /* light purple */
  }
  th, td { border:1px solid #ccc; padding:10px; text-align:left; }
  th { background-color:#e0f7fa; }
  .correct-text { color:#2e7d32; font-weight:bold; }
  .incorrect-text { color:#c62828; font-weight:bold; }

  /* small screens */
  @media (max-width:520px) {
    .palette { grid-template-columns: repeat(4,1fr); }
    .meta { flex-direction:column; align-items:flex-start; gap:6px; }
    .header-right { gap:6px; font-size:13px;}
  }

</style>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  svg: { fontCache: 'global' }
};
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

<!-- MathJax for LaTeX rendering -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>

<header>
  <div class="brand">
    <div class="logo"><img src="logo.png" alt="Physiquate Logo" /></div>
    <div>
      <h1>Physiquate</h1>
      <p style="opacity:0.85">Physics Competitive Exam Portal</p>
    </div>
  </div>

  <div class="header-right">
    <div class="user-info" id="header-exam-title">Mathematical Physics - Vector Calculus</div>
    <div class="timer" id="timer"><i class="fa-regular fa-clock"></i> <span id="timer-val">00:00</span></div>
  </div>
</header>

<main>
  <div class="exam-wrap">

    <!-- LEFT: Question Card -->
    <div class="card" id="left-card">

      <!-- Student form (start) -->
      <div id="student-form">
        <h2 style="margin-bottom:10px;">Enter Candidate Details</h2>
        <div style="margin-bottom:10px;"><label style="display:block;font-weight:600;margin-bottom:6px;">Name</label><input id="student-name" type="text" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9"></div>
        <div style="margin-bottom:10px;"><label style="display:block;font-weight:600;margin-bottom:6px;">Email</label><input id="student-email" type="email" placeholder="example@domain.com" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9"></div>
        <div style="margin-bottom:10px;"><label style="display:block;font-weight:600;margin-bottom:6px;">Exam title</label><input id="exam-title" type="text" value="Mathematical Physics Vector calculus - set 2" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9"></div>
        <div style="display:flex;gap:10px;">
          <button class="cta" id="start-exam">Start Exam</button>
          
        </div>
      </div>
      <!-- /student form -->

      <!-- Exam area (hidden until start) -->
      <div id="exam" style="display:none;">
        <div class="meta">
          <div>
            <div class="title" id="q-num">Q1</div>
            <div class="small" id="q-type">Single correct</div>
          </div>
          <div class="small" id="q-timer">Time left: <span id="timer-small">--:--</span></div>
        </div>

        <!-- Questions are inserted here dynamically -->
        <!-- Each .question element will be displayed/hidden by JS -->
        <!-- We will create them in the same manner as original logic -->
        <div id="questions-root"></div>

        <div class="controls">
          <div style="display:flex; gap:8px;">
            <button class="muted" id="prev">Previous</button>
            <button class="muted" id="next">Next</button>
            <button class="muted" id="mark">Mark for review</button>
          </div>
          <div style="display:flex; gap:8px;">
            <button class="cta" id="save-next">Save & Next</button>
            <button class="cta" id="submit-btn" style="background:#059669">Submit Exam</button>
          </div>
        </div>
      </div>
      <!-- /exam area -->

      <!-- Result area -->
      <div id="result" style="display:none; margin-top:12px;">
        <h3>Exam Report</h3>
        <p id="student-info" style="font-size:14px;color:#334155"></p>
        <p id="score-summary" style="font-weight:600"></p>
        <div style="overflow-x:auto;">
          <table class="result-table" id="result-table" style="display:none;">
            <thead>
              <tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Status</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px;">
          <button class="muted" id="home-btn">Home</button>
          <button class="cta" id="download-csv">Download CSV</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: Side panel -->
    <div class="side">
      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <div style="font-weight:700;">Progress</div>
          <div id="progress-text" style="font-size:13px;color:#475569">0 / 0</div>
        </div>
        <div class="progress" aria-hidden="true"><i id="progress-bar"></i></div>
        <div style="margin-top:12px; font-size:13px; color:#475569;">Question Palette</div>
        <div class="palette" id="palette-root" style="margin-top:8px;">
          <!-- buttons per question created by JS -->
        </div>
      </div>

      <div class="panel">
        <div style="font-weight:700; margin-bottom:8px;">Exam Info</div>
        <div style="font-size:14px; color:#475569;">
          Duration: <span id="duration-text">30</span><br>
          Total Questions: <span id="total-q">0</span>
        </div>
      </div>

    </div>

  </div> <!-- exam-wrap -->
</main>

<!-- ===== JavaScript: your original logic with only small adjustments ===== -->
<script>
document.addEventListener('DOMContentLoaded', function(){
// ========== MathJax Render Helper ==========
function renderMath() {
  if (window.MathJax) {
    MathJax.typesetPromise().catch((err) => console.error("MathJax render error:", err.message));
  }
}

  // Helper shuffle
  function shuffleArray(array){
    for(let i=array.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // =========================================== Step 1: Questions Array (inline LaTeX fixed) =====================================================
  let questionsArray = [
      { q: "A vector \\(\\vec{A} = (5x+3y)\\hat{i}+(3y-z)\\hat{j}+(2x-az)\\hat{k}\\) is solinoidal, if the value of a has a value", 
        options: ["4","-4","8","-8"], 
        answer: 2
        },
        { q: "The unit vector normal to the surface \\(3x^2+4y=z\\) at the point (1,1,7) is", 
        options: ["\\(\\frac{-6\\hat{i}+4\\hat{j}+\\hat{k}}{\\sqrt{53}}\\)","\\(\\frac{4\\hat{i}+6\\hat{j}-\\hat{k}}{\\sqrt{53}}\\)","\\(\\frac{6\\hat{i}+4\\hat{j}-\\hat{k}}{\\sqrt{53}}\\)","\\(\\frac{4\\hat{i}+6\\hat{j}+\\hat{k}}{\\sqrt{53}}\\)"],
        answer: 2
        },
        
        { q: "The two vectors \\(\\vec{p}=\\hat{i}, \\; \\hat{i}+\\hat{j} = \\sqrt{2}\\)", 
        options: ["related by a rotation","related by a reflection through xy plane","related by inversion","not linearly independent"],
        answer: 0
        },
        
        { q: "the curl of the vector \\(z\\hat{i} + x \\hat{j} + y\\hat{k}\\) is given by", 
        options: ["\\(\\hat{i}+\\hat{j}+\\hat{k}\\)","\\(\\hat{i}-\\hat{j}+\\hat{k}\\)","\\(\\hat{i}+\\hat{j}-\\hat{k}\\)","-\\(\\hat{i}-\\hat{j}-\\hat{k}\\)"],
        answer: 0
        },
        
        
        { q: "Consider a vector \\(\\vec{V} = \\frac{\\vec{r}}{r^3}\\). The surface integral of this vector over the surface of a cube of size a and centred at the origin", 
        options: ["0","\\(2\\pi\\)","\\(2\\pi a^3\\)","\\(4\\pi\\)"],
        answer: 3
        },
        
        { q: "which of the following is not correct for this vector \\(\\vec{V} = \\frac{\\vec{r}}{r^3}\\)", 
        options: ["value of line integral of this vector arround any closed curve is zero",
        "this vector can be written as the gradient of some scalar funtion",
        "the line integral of this vector from point P to Q is ibdipendent of path taken",
        "the vector can represent magnetic field of some current distribusion"],
        answer: 3
        },
        { q: "For the function \\(x^2y \\; + \\; xy \\), the value of \\(|\\vec{\\nabla}\\phi|\\) at \\(x=y=1\\)", 
        options: ["5","\\(\\sqrt{5}\\)","13","\\(\\sqrt{13}\\)"], 
        answer: 2 
        },
        { q: "The unit normal vector to the curve \\(x^3y^2+xy=17\\) at the point (2,0)", 
        options: ["\\(\\frac{\\hat{i}+\\hat{j}}{\\sqrt{2}}\\)","\\(-\\hat{i}\\)","\\(-\\hat{j}\\)","\\(\\hat{j}\\)"], 
        answer: 2 
        },
        { q: "If the vector field \\(\\vec{F} = x \\hat{j}+2y\\hat{j}+3z\\hat{k}\\). Then \\(\\nabla\\times(\\nabla\\times\\vec{F})\\) is ", 
        options: ["0","\\(\\hat{i}\\)","\\(2\\hat{j}\\)","\\(3\\hat{k}\\)"], 
        answer: 0 
        },
        { q: "Evaluate: \\(\\int_{-\\infty}^{\\infty}\\;e^{-x^2} \\delta'(x-1)dx\\)", 
        options: ["-2/e","2/e","e/2","-e/2"], 
        answer: 1
        },
        { q: "Evaluate: \\(\\int_{-\\infty}^{\\infty}\\; x^{2} sinx \\; \\delta'(x-\\frac{\\pi}{2})dx\\)", 
        options: ["\\(-\\pi\\)","\\(\\pi\\)","\\(\\frac{\\pi}{2}\\)","\\(\\frac{1}{\\pi}\\)"], 
        answer: 0 
        },
        { q: "Evaluate: \\(\\int_{-\\infty}^{\\infty}\\;(2x^{3}+5x-7)\\delta'(x)dx\\)", 
        options: ["5","1/5","-1/5","-5"], 
        answer: 3
        },
        { q: "Evaluate: \\(\\int_{-\\infty}^{\\infty}\\;x^{4}\\delta'(x)dx\\)", 
        options: ["0","-1","4","-4"], 
        answer: 0
        },
        { q: "Evaluate: \\(\\int_{-\\infty}^{\\infty}\\;\\delta'(x-1)dx\\)", 
        options: ["0","-1","1","1/2"], 
        answer: 0 
        },
        { q: "Evaluate: \\(\\int_{-\\infty}^{\\infty}\\;cos(\\frac{\\pi}{2}x)\\delta'(6x^{2}-x-1)dx\\)", 
        options: ["\\(\\frac{\\sqrt{10}}{3}+\\frac{1}{2\\sqrt{5}}\\)","\\(\\frac{-\\sqrt{5}}{10}+\\frac{1}{5\\sqrt{2}}\\)","\\(\\frac{\\sqrt{5}}{10}-\\frac{1}{5\\sqrt{2}}\\)","\\(\\frac{\\sqrt{3}}{10}+\\frac{1}{5\\sqrt{2}}\\)"], 
        answer: 3 
        },
        { q: "Evaluate: \\(\\int_{0}^{\\infty}\\;\\delta(cosx)e^{-x}dx\\)", 
        options: ["\\(-\\frac{1}{2 sinh{\\pi/2}}\\)","\\(\\frac{1}{2 sinh{\\pi/2}}\\)","\\(\\frac{1}{2 cosh{\\pi/2}}\\)","\\(-\\frac{1}{2 sinh{\\pi/2}}\\)"], 
        answer: 1 
        },
        { q: "Evaluate: \\(\\int_{0}^{\\infty}\\;\\delta(sinx)e^{-x}dx\\)", 
        options: ["\\(\\frac{1-e^{-1}}{1+e^{-1}}\\)","\\(\\frac{e^{-1}+1}{e^{-1}-1}\\)","\\(\\frac{1+e^{-1}}{1-e^{-1}}\\)","\\(\\frac{e^{-1}-1}{e^{-1}+1}\\)"], 
        answer: 2 
        },
        { q: "Evaluate: \\(\\int_{-1}^{1}dy[\\int_{-\\pi/2}^{\\pi/2}dx\\; \\delta(sin2x)\\delta(x-y)]\\)", 
        options: ["1/2","-1/2","2","-2"], 
        answer: 2 
        },
        { q: "Evaluate the integral \\(j=\\int_{v}(r^2+2)\\vec{\\nabla} \\cdot\\frac{\\hat{r}}{r^2}d\\tau\\) where v is a sphere of radius R centered at the origin", 
        options: ["\\(2\\pi\\)","\\(4\\pi\\)","\\(6\\pi\\)","\\(8\\pi\\)"], 
        answer: 3 
        },
        { q: "Evaluate: \\(\\int_{0}^{1}\\;x^3\\delta(x-2)dx\\)", 
        options: ["0","4","6","12"], 
        answer: 3 
        },


    // ... (add or keep the rest of questions as in your original file)
    // For brevity I include the main ones; keep the whole array you had originally here.
  ];

  // If you kept all questions, they will be shuffled below
  questionsArray = shuffleArray(questionsArray);

  // Shuffle options but keep correct mapping
  questionsArray.forEach(q=>{
    const correctValue = q.options[q.answer];
    q.options = shuffleArray(q.options.slice());
    q.answer = q.options.indexOf(correctValue);
  });

  // ========== Create elements dynamically ==========
  const examDiv = document.getElementById('exam');
  const questionsRoot = document.getElementById('questions-root');
  const paletteRoot = document.getElementById('palette-root');
  const totalQSpan = document.getElementById('total-q');

  // create question nodes
  questionsArray.forEach((item,index)=>{
    const qDiv = document.createElement('div');
    qDiv.classList.add('question');
    qDiv.id = `q${index+1}`;
    qDiv.style.display = 'none'; // hidden initially
    

    // question text
    const p = document.createElement('div');
    p.style.marginBottom = '10px';
    p.innerHTML = `<div style="font-weight:600; margin-bottom:6px;">${index+1}. </div> <div>${item.q}</div>`;
    qDiv.appendChild(p);

    // options container
    const optionsDiv = document.createElement('div');
    optionsDiv.classList.add('options');

    item.options.forEach((opt,i)=>{
      // IMPORTANT: put input and a span so we can style input:checked + span
      const label = document.createElement('label');
      label.htmlFor = `q${index+1}_opt${i}`;

      const input = document.createElement('input');
      input.type = 'radio';
      input.name = `q${index+1}`;
      input.id = `q${index+1}_opt${i}`;
      input.value = i;

      const span = document.createElement('span');
      span.className = 'opt-text';
      span.innerHTML = opt;

      // append to label: input then span
      label.appendChild(input);
      label.appendChild(span);

      optionsDiv.appendChild(label);
    });

    qDiv.appendChild(optionsDiv);
    questionsRoot.appendChild(qDiv);

    // palette button
    const pal = document.createElement('button');
    pal.className = 'pal-btn';
    pal.innerText = index+1;
    pal.dataset.index = index;
    pal.addEventListener('click', ()=>{ showQuestion(index); });
    paletteRoot.appendChild(pal);
  });
  renderMath();

  totalQSpan.innerText = questionsArray.length;

  // ========== State and helpers ==========
  let current = 0;
  const questions = document.querySelectorAll('.question');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const submitBtn = document.getElementById('submit-btn');
  const saveNextBtn = document.getElementById('save-next');
  const paletteButtons = document.querySelectorAll('.pal-btn');
  const progressBar = document.getElementById('progress-bar');
  const progressText = document.getElementById('progress-text');
  const timerVal = document.getElementById('timer-val');
  const timerSmall = document.getElementById('timer-small');
  const headerExamTitle = document.getElementById('header-exam-title');
  const studentInfoP = document.getElementById('student-info');

  function showQuestion(index){
    // bounds
    if(index < 0) index = 0;
    if(index >= questions.length) index = questions.length - 1;
    current = index;
    questions.forEach((q,i)=>{
      q.style.display = (i===index)?'block':'none';
    });
    // update palette visuals
    document.querySelectorAll('.pal-btn').forEach((b,i)=>{
      b.classList.toggle('current', i===index);
      // answered?
      const sel = document.querySelector(`#q${i+1} input[type="radio"]:checked`);
      b.classList.toggle('answered', !!sel);
    });
    // update meta
    document.getElementById('q-num').innerText = `Q${index+1}`;
    // update progress
    updateProgress();
    // typeset math
    MathJax.typesetPromise();
    // scroll left card to top
    document.getElementById('left-card').scrollIntoView({behavior:'smooth', block:'start'});
    
  }
  


  function updateProgress(){
    const answered = [...questions].filter((q,i)=> q.querySelector('input[type="radio"]:checked')).length;
    const total = questions.length;
    const percent = Math.round((answered/total)*100);
    progressBar.style.width = percent + '%';
    progressText.innerText = `${answered} / ${total}`;
  }

  prevBtn.addEventListener('click', ()=>{ if(current>0) showQuestion(current-1); });
  nextBtn.addEventListener('click', ()=>{ if(current<questions.length-1) showQuestion(current+1); });

  // Save & Next: just move to next after ensuring one selection preserved
  saveNextBtn.addEventListener('click', ()=>{
    // nothing extra here; selections persist
    if(current < questions.length - 1) showQuestion(current+1);
  });

  // Submit handler
  submitBtn.addEventListener('click', submitExam);

  // ========== Timer (demo short duration, change as needed) ==========
  let countdown;
  function startTimer(seconds){
    let time = seconds;
    clearInterval(countdown);
    function tick(){
      if(time < 0){
        clearInterval(countdown);
        alert('Time finished. Submitting exam.');
        submitExam();
        return;
      }
      const m = Math.floor(time/60);
      const s = time % 60;
      timerVal.innerText = `${m}:${s < 10 ? '0'+s : s}`;
      timerSmall.innerText = `${m}:${s < 10 ? '0'+s : s}`;
      time--;
    }
    tick();
    countdown = setInterval(tick, 1000);
  }

  // ========== Start exam logic ==========
  const startBtn = document.getElementById('start-exam');
  const studentForm = document.getElementById('student-form');
  const examArea = document.getElementById('exam');
  const resultDiv = document.getElementById('result');
  startBtn.addEventListener('click', ()=>{
    const name = document.getElementById('student-name').value.trim();
    const email = document.getElementById('student-email').value.trim();
    const title = document.getElementById('exam-title').value.trim();
    if(!name){ alert('Name required'); return; }
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!email || !emailPattern.test(email)){ alert('Valid email required'); return; }
    if(!title){ alert('Exam title required'); return; }

    headerExamTitle.innerText = title;
    studentInfoP.innerHTML = `<strong>Name:</strong> ${name} | <strong>Email:</strong> ${email} | <strong>Exam:</strong> ${title}`;
    // show exam area
    studentForm.style.display = 'none';
    examArea.style.display = 'block';
    // show first question
    showQuestion(0);
    // start timer (set 1 minute for demo; change to desired seconds)
    document.getElementById('duration-text').innerText = '30 minutes';
    startTimer(30*60); // change 60 to desired total seconds, e.g., 3600 for 1 hour
  });


  // ========== Submit Exam Implementation ==========
  function submitExam(){
    clearInterval(countdown);
    // compute score
    let score = 0;
    const tbody = document.querySelector('#result-table tbody');
    tbody.innerHTML = '';
    questionsArray.forEach((item,index)=>{
      const qDiv = document.getElementById(`q${index+1}`);
      const selected = qDiv.querySelector('input[type="radio"]:checked');
      const userAnswer = selected ? parseInt(selected.value) : -1;
      const status = userAnswer === item.answer ? 'Correct' : 'Incorrect';
      if(status === 'Correct') score++;

      const userText = userAnswer === -1 ? 'Not Answered' : item.options[userAnswer];
      const correctText = item.options[item.answer];

      tbody.innerHTML += `<tr>
        <td style="max-width:300px; word-wrap:break-word;">${item.q}</td>
        <td>${userText}</td>
        <td>${correctText}</td>
        <td style="font-weight:700; color:${status==='Correct'?'#166534':'#b91c1c'}">${status}</td>
      </tr>`;
      // Rerender MathJax for the new content
      MathJax.typesetPromise([tbody]).catch((err) => console.error(err.message));
    });

    const pct = ((score / questionsArray.length) * 100).toFixed(2);
    let grade = '';
    if(pct >= 90) grade = 'A+';
    else if(pct >= 80) grade = 'A';
    else if(pct >= 70) grade = 'B';
    else if(pct >= 60) grade = 'C';
    else grade = 'F';

    document.getElementById('score-summary').innerText = `Score: ${score}/${questionsArray.length} | Percentage: ${pct}% | Grade: ${grade}`;

    // show result panel
    document.getElementById('result-table').style.display = 'table';
    examArea.style.display = 'none';
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({behavior:'smooth'});
  }

  // home button
  document.getElementById('home-btn').addEventListener('click', ()=>{
    // reload page to reset
    window.location.href = 'index.html'; // <-- link to your home page
  });

  // CSV download
  document.getElementById('download-csv').addEventListener('click', ()=>{
    let csv = 'Question,Your Answer,Correct Answer,Status\\n';
    questionsArray.forEach((item,index)=>{
      const qDiv = document.getElementById(`q${index+1}`);
      const selected = qDiv.querySelector('input[type="radio"]:checked');
      const userAnswer = selected ? item.options[parseInt(selected.value)] : 'Not Answered';
      const correctText = item.options[item.answer];
      const status = (userAnswer === correctText) ? 'Correct' : 'Incorrect';
      // simple escaping of commas
      csv += `"${item.q.replace(/"/g,'""')}","${userAnswer.replace(/"/g,'""')}","${correctText.replace(/"/g,'""')}","${status}"\\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'exam_results.csv'; a.click();
    URL.revokeObjectURL(url);
  });

  // initial progress update
  updateProgress();
  // ===== Step 5: Render Math =====
  if (window.MathJax) {
    MathJax.typesetPromise();
  }
}); // DOMContentLoaded
</script>

</body>
</html>







