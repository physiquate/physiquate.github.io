<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Physiquate Exam Portal — Modern</title>

<!-- Google Font and icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- ===== Modern Styles ===== -->
<style>
  /* Reset */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html,body { height: 100%; }

  body {
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#f8fafc 0%, #eef2f7 100%);
    color: #0f172a;
    line-height: 1.45;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Header */
  header {
    background: #1e3a8a;
    color: #fff;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    box-shadow: 0 4px 18px rgba(2,6,23,0.12);
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  .brand {
    display:flex;
    gap:12px;
    align-items:center;
  }
  .brand .logo {
    width: 60px;           /* adjust size as needed */
    height: 60px;          /* adjust size as needed */
    border-radius: 8px;    /* optional rounded corners */
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;      /* remove gradient background */
    box-shadow: none;      /* remove shadow if you don’t want it */
    font-size: 0;          /* hides old icon text if any */
  }

  .brand .logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;   /* ensures image fits without stretching */
    border-radius: 8px;    /* keeps the corners rounded if desired */
  }
  .brand h1 { font-size:18px; font-weight:700; letter-spacing:0.2px; margin:0; }
  .brand p { font-size:12px; opacity:0.9; margin:0; }

  .header-right { display:flex; gap:12px; align-items:center; }
  .timer {
    background: rgba(255,255,255,0.08);
    padding: 6px 12px;
    border-radius: 8px;
    font-weight:600;
    display:flex; gap:8px; align-items:center;
  }
  .user-info { font-size:14px; color:rgba(255,255,255,0.95); }

  /* Main container */
  main {
    max-width: 1100px;
    margin: 28px auto;
    padding: 0 18px;
  }
  .exam-wrap {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 20px;
    align-items: start;
  }
  @media (max-width: 920px) {
    .exam-wrap { grid-template-columns: 1fr; }
  }

  /* Left panel (question card) */
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
  }
  .meta {
    display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px;
  }
  .meta .title { font-weight:600; color:#0f172a; }
  .meta .small { font-size:13px; color:#475569; }

  .question { font-size:18px; font-weight:600; margin-bottom:14px; color:#0b1220; }
  .options { margin-top:6px; }
  /* Option markup: we render <label><input><span class="opt-text"> text </span></label> */
  .options label {
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #e6edf6;
    margin-bottom:10px;
    cursor:pointer;
    transition: all 0.16s ease;
    background: #fbfdff;
  }
  .options label:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(16,24,40,0.04); border-color:#cfe3ff; }
  .options input[type="radio"] { width:18px; height:18px; accent-color:#1e3a8a; }
  .options .opt-text { flex:1; font-size:15px; color:#111827; }

  /* Highlight when checked: input:checked + .opt-text, and also style label background */
  .options input[type="radio"]:checked + .opt-text {
    font-weight:700;
    color:#0b1220;
  }
  /* To style label background when checked, use :has if supported, else we apply a small visual using sibling:
     Provide fallback: bright border on :checked. */
  /* Modern browsers: :has */
  @supports(selector(:has(*))) {
    .options label:has(input[type="radio"]:checked) {
      background: linear-gradient(90deg, rgba(219,234,254,0.35), rgba(235,241,255,0.5));
      border-color: #1e3a8a;
    }
  }
  /* Fallback for browsers without :has: style via checked + span (border on left) */
  .options input[type="radio"]:checked + .opt-text {
    outline: none;
    border-left: 4px solid #1e3a8a;
    padding-left:8px;
  }

  /* Right panel (summary, palette) */
  .side {
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .panel {
    background:#fff;
    border-radius:12px;
    padding:14px;
    box-shadow:0 8px 20px rgba(2,6,23,0.04);
  }
  .progress {
    height:12px;
    background:#eef2ff;
    border-radius:999px;
    overflow:hidden;
  }
  .progress > i {
    display:block;
    height:100%;
    width:0%;
    background: linear-gradient(90deg,#2563eb,#1e3a8a);
    transition: width 300ms ease;
  }

  .palette {
    display:grid;
    grid-template-columns: repeat(5,1fr);
    gap:8px;
  }
  .pal-btn {
    padding:10px; border-radius:8px; border:1px solid #e2e8f0; text-align:center; font-weight:600; cursor:pointer;
    background:#fff;
  }
  .pal-btn.answered { background:#dcfce7; border-color:#bbf7d0; color:#165b2e; }
  .pal-btn.current { box-shadow: 0 6px 18px rgba(16,24,40,0.06); border-color:#93c5fd; }

  /* Controls bottom */
  .controls {
    display:flex; gap:10px; margin-top:14px; justify-content:space-between; align-items:center;
  }
  .controls .cta {
    background:#1e3a8a; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600;
  }
  #start-exam {
      background: #059669;           /* green like submit */
      color: #fff;
      border: none;
      padding: 10px 14px;            /* same size as submit */
      border-radius: 8px;            /* same rounded corners */
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;               /* ensure same text size */
      transition: all 0.16s ease;    /* smooth hover like submit */
  }
  #start-exam:hover {
      background: #047857;           /* slightly darker green on hover */
      transform: translateY(-2px);   /* subtle lift like other buttons */
      box-shadow: 0 6px 18px rgba(16,24,40,0.04);
  }
  #download-csv {
      background: #059669;           /* green like submit */
      color: #fff;
      border: none;
      padding: 10px 14px;            /* same size as submit */
      border-radius: 8px;            /* same rounded corners */
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;               /* ensure same text size */
      transition: all 0.16s ease;    /* smooth hover like submit */
  }
  #download-csv:hover {
      background: #047857;           /* slightly darker green on hover */
      transform: translateY(-2px);   /* subtle lift like other buttons */
      box-shadow: 0 6px 18px rgba(16,24,40,0.04);
  }
  .controls .muted { background:#f1f5f9; color:#334155; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }
  #home-btn {
        background: #059669;           /* green like submit */
        color: #fff;
        border: none;
        padding: 10px 14px;            /* same size as submit */
        border-radius: 8px;            /* same rounded corners */
        cursor: pointer;
        font-weight: 600;
        font-size: 15px;               /* ensure same text size */
        transition: all 0.16s ease;    /* smooth hover like submit */
    }
    #home-btn:hover {
        background: #047857;           /* slightly darker green on hover */
        transform: translateY(-2px);   /* subtle lift like other buttons */
        box-shadow: 0 6px 18px rgba(16,24,40,0.04);
    }
  /* Result table */
  .result-table { width:100%; border-collapse:collapse; margin-top:8px; font-size:14px; }
  .result-table th, .result-table td { padding:8px 10px; border:1px solid #e6eef9; text-align:left; }
  .result-table th { background:#f1f5f9; font-weight:600; }
  
  /* ===== Result Row Colors ===== */
  tr.correct-row {
  background-color: #e8f5e9; /* light green */
  }
  tr.incorrect-row {
    background-color: #ffebee; /* light red */
  }
  tr.unanswered-row {
    background-color:rgba(75, 78, 79, 0.2); /* light purple */
  }
  th, td { border:1px solid #ccc; padding:10px; text-align:left; }
  th { background-color:#e0f7fa; }
  .correct-text { color:#2e7d32; font-weight:bold; }
  .incorrect-text { color:#c62828; font-weight:bold; }

  /* small screens */
  @media (max-width:520px) {
    .palette { grid-template-columns: repeat(4,1fr); }
    .meta { flex-direction:column; align-items:flex-start; gap:6px; }
    .header-right { gap:6px; font-size:13px;}
  }

</style>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  svg: { fontCache: 'global' }
};
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

<!-- MathJax for LaTeX rendering -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>

<header>
  <div class="brand">
    <div class="logo"><img src="logo.png" alt="Physiquate Logo" /></div>
    <div>
      <h1>Physiquate</h1>
      <p style="opacity:0.85">Physics Competitive Exam Portal</p>
    </div>
  </div>

  <div class="header-right">
    <div class="user-info" id="header-exam-title">Mathematical Physics - Vector Calculus</div>
    <div class="timer" id="timer"><i class="fa-regular fa-clock"></i> <span id="timer-val">00:00</span></div>
  </div>
</header>

<main>
  <div class="exam-wrap">

    <!-- LEFT: Question Card -->
    <div class="card" id="left-card">

      <!-- Student form (start) -->
      <div id="student-form">
        <h2 style="margin-bottom:10px;">Enter Candidate Details</h2>
        <div style="margin-bottom:10px;"><label style="display:block;font-weight:600;margin-bottom:6px;">Name</label><input id="student-name" type="text" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9"></div>
        <div style="margin-bottom:10px;"><label style="display:block;font-weight:600;margin-bottom:6px;">Email</label><input id="student-email" type="email" placeholder="example@domain.com" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9"></div>
        <div style="margin-bottom:10px;"><label style="display:block;font-weight:600;margin-bottom:6px;">Exam title</label><input id="exam-title" type="text" value="Mathematical Physics Vector calculus - set 3" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9"></div>
        <div style="display:flex;gap:10px;">
          <button class="cta" id="start-exam">Start Exam</button>
          
        </div>
      </div>
      <!-- /student form -->

      <!-- Exam area (hidden until start) -->
      <div id="exam" style="display:none;">
        <div class="meta">
          <div>
            <div class="title" id="q-num">Q1</div>
            <div class="small" id="q-type">Single correct</div>
          </div>
          <div class="small" id="q-timer">Time left: <span id="timer-small">--:--</span></div>
        </div>

        <!-- Questions are inserted here dynamically -->
        <!-- Each .question element will be displayed/hidden by JS -->
        <!-- We will create them in the same manner as original logic -->
        <div id="questions-root"></div>

        <div class="controls">
          <div style="display:flex; gap:8px;">
            <button class="muted" id="prev">Previous</button>
            <button class="muted" id="next">Next</button>
            <button class="muted" id="mark">Mark for review</button>
          </div>
          <div style="display:flex; gap:8px;">
            <button class="cta" id="save-next">Save & Next</button>
            <button class="cta" id="submit-btn" style="background:#059669">Submit Exam</button>
          </div>
        </div>
      </div>
      <!-- /exam area -->

      <!-- Result area -->
      <div id="result" style="display:none; margin-top:12px;">
        <h3>Exam Report</h3>
        <p id="student-info" style="font-size:14px;color:#334155"></p>
        <p id="score-summary" style="font-weight:600"></p>
        <div style="overflow-x:auto;">
          <table class="result-table" id="result-table" style="display:none;">
            <thead>
              <tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Status</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px;">
          <button class="muted" id="home-btn">Home</button>
          <button class="cta" id="download-csv">Download CSV</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: Side panel -->
    <div class="side">
      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <div style="font-weight:700;">Progress</div>
          <div id="progress-text" style="font-size:13px;color:#475569">0 / 0</div>
        </div>
        <div class="progress" aria-hidden="true"><i id="progress-bar"></i></div>
        <div style="margin-top:12px; font-size:13px; color:#475569;">Question Palette</div>
        <div class="palette" id="palette-root" style="margin-top:8px;">
          <!-- buttons per question created by JS -->
        </div>
      </div>

      <div class="panel">
        <div style="font-weight:700; margin-bottom:8px;">Exam Info</div>
        <div style="font-size:14px; color:#475569;">
          Duration: <span id="duration-text">30</span><br>
          Total Questions: <span id="total-q">0</span>
        </div>
      </div>

    </div>

  </div> <!-- exam-wrap -->
</main>

<!-- ===== JavaScript: your original logic with only small adjustments ===== -->
<script>
document.addEventListener('DOMContentLoaded', function(){
// ========== MathJax Render Helper ==========
function renderMath() {
  if (window.MathJax) {
    MathJax.typesetPromise().catch((err) => console.error("MathJax render error:", err.message));
  }
}

  // Helper shuffle
  function shuffleArray(array){
    for(let i=array.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // =========================================== Step 1: Questions Array (inline LaTeX fixed) =====================================================
  let questionsArray = [
    { q: "A function defined in cartesian coordinates \\(f(x,y)=xe^{y}\\). The value of the directional derivative of the function (in integer) at the point (2,0) along the direction of the straight line from point (2,0) to the point (½, 2) is …………", 
    options: ["1","-1","5/2","-5/2"], 
    answer: 0 
    },
    { q: `The vector function \\(\\vec{F}(r)=-x\\hat{i}+y\\hat{j}\\) is defined over a circular arc is shown in the figure. The line integral of \\(\\int_{c}F(r)\\cdot dr\\) is <figure><img src="set_4_qn_2.png" alt=" graph"width="300"><figure>`, 
    options: ["1/2","1/3","1/4","1/6"], 
    answer: 0 
    },
    { q: "The unit vector along mutually perpendicular x,y, and z axes \\(\\hat{i},\\hat{j} and \\hat{k}\\) respectively. Consider the plane z=0 and the two vectors \\(\\vec{a} and \\vec{b}\\) on that plane such that \\(\\vec{a} \\neq \\alpha \\vec{b}\\) for any scalar \\(\\alpha\\). A vector perpendicular to both \\(\\vec{a} and \\vec{b}\\) is….", 
    options: ["\\(-\\vec{j}\\)","\\(\\vec{i}-\\vec{j}\\)","\\(\\vec{i}\\)","\\(\\vec{k}\\)"], 
    answer: 3 
    },
    { q: "A vector field is defined as \\(\\vec{f}(x,y,z) = \\frac{x}{(x^2+y^2+z^2)^{3/2}}\\hat{i}+\\frac{y}{(x^2+y^2+z^2)^{3/2}}\\hat{j}+\\frac{z}{(x^2+y^2+z^2)^{3/2}}\\hat{k}\\). Where \\(\\hat{i},\\hat{j} and \\hat{k}\\) are unit vectors along the aes of a rectangular / cartesian coordinate system. The surface integral \\(\\iint \\vec{f}\\cdot \\vec{ds}\\) (where \\(\\vec{ds}\\) is an elemental surface area vector) evaluated over the inner and outer surface of a spherical shell formed by a two concentric spheres with origin as the center and internal and external radii of 1 and 2 respectively, is", 
    options: ["4\\(\\pi\\)","0","2\\(\\pi\\)","8\\(\\pi\\)"], 
    answer: 1 
    }, 
    { q: "For three vectors \\(\\vec{A}= 2 \\hat{j} —3\\hat{k} , \\vec{B} = -2\\hat{i}+\\hat{k} \\; and \\; \\vec{C}= 3\\hat{i} -\\hat{j} , where \\; \\hat{i}, \\hat{j} \\; and \\; \\hat{k}\\) are unit vectors along the axes of a right-handed rectangular/ cartesian coordinate system, the value of \\(\\vec{A}\\cdot (\\vec{B} \\times \\vec{C}) + 6)\\) is…", 
    options: ["9","6","-6","-9"], 
    answer: 1 
    },
    { q: "The directional derivative of \\(f(x, y, z) = XYZ\\) at point (-1, 1, 3) in the direction of vector \\(\\hat{i}-2\\hat{j}+2\\hat{k}\\) is", 
    options: ["7","7/3","\\(3\\hat{i}-3\\hat{j}+\\hat{k}\\) ","5/3"], 
    answer: 1 
    }, 
    { q: `Let \\(a_{x}\\) and \\(a_{y}\\)  be unit vectors along x and y directions, respectively. A vector function is given by \\(\\vec{F} = a_{x}y - a_{y}x\\). The line integral Of the above function \\(\\int_{c} \\vec{F}. \\vec{dl}\\) along the curve C, which follows the parabola \\(y = x^{2}\\) as shown below is <figure><img src="set_4_qn_7.png" alt=" graph"width="300"><figure>`, 
    options: ["9","-9","-3","3"], 
    answer: 2 
    },
    { q: "The vector function expressed by \\(\\vec{F} = a_{x}(5y - k_{1}z) + a_{y}(3z + k_{2}x) + a_{z}(k_{3}y - 4x)\\) represents a conservative field, where \\(a_{x} .a_{y}. A_{z}\\) are unit vectors along x, y and z directions respectively. The values of constants  \\{k_{1},  k_{2} and  k_{3}\\) are given by", 
    options: ["\\(k_{1}=3,  k_{2}=3,  k_{3}=7\\) ","\\(k_{1}=0,  k_{2}=0,  k_{3}=0\\)","\\(k_{1}=4,  k_{2}=5,  k_{3}=3\\) ","\\(k_{1}=3,  k_{2}=8,  k_{3}=5\\) "], 
    answer: 2 
    },
    { q: "For a vector field \\(\\vec{A}\\), which one of the following is false", 
    options: ["A is irrotational if  \\(\\nabla^{2}\\vec{A}=0\\)"," \\(\\nabla \\times (\\nabla \\times \\vec{A}) = \\nabla (\\nabla \\cdot \\vec{A}) \\cdot \\nabla^{2}\\vec{A}\\)","\\(\\nabla \\times \\vec{A}\\) is also another vector field","\\(\\vec{A}\\) is solenoidal if \\(\\nabla \\cdot \\vec{A}=0\\)"], 
    answer: 0 
    },
    { q: "If C represents a line segment between (0, 0, 0) and (1, 1, 1) in Cartesian coordinate system, the value (expressed as integer) of the line integral \\(\\int_{c}[(y + z) dx + (x + z) dy + (x + y) dz]\\) is…..", 
    options: ["1","2","3","4"], 
    answer: 2 
    }, 
    { q: "The vector function \\(\\vec{A}\\) is given  \\(\\vec{A} = \\vec{\\nabla}u\\), where u(x, y) is a scalar function. Then  \\(|\\nabla \\times \\vec{A}|\\) is", 
    options: ["-1","1","0","\\(\\infty\\)"], 
    answer: 2 
    }, 
    { q: "Given a vector \\(\\vec{u} = \\frac{1}{3}( -y^{3}\\hat{i}- x^{3} \\hat{j}+ z^{3}\\hat{k})\\) and \\(\\hat{n}\\) as the unit normal vector to the surface of the hemisphere \\(x^{2}+y^{2}+z^{2}=1 z\\geq = 0\\) the value of integral \\(int(\\nabla\\times\\vec{u}\\cdot\\vec{ds})\\). n ds evaluated on the curved surface of the hemisphere S is", 
    options: ["\\(-\\pi/2\\)","\\(\\pi/3\\)","\\(\\pi/2\\)","\\(\\pi\\)"], 
    answer: 2 
    },
    { q: "Consider a vector \\(\\vec{p}=2\\hat{i}+3\\hat{j}+2\\hat{k}\\) in coordinate system \\(\\hat{i},\\hat{j},\\hat{k}\\), the axes are rotated anticlockwise about y axis by an angle of \\(60^{o}\\). The vector \\(\\vec{p}\\) in the rotated coordinate system", 
    options: ["\\((1-\\sqrt{3})\\hat{i’}+3\\hat{j’}(1+\\sqrt{3})\\hat{k’}\\)","\\((1+\\sqrt{3})\\hat{i’}+3\\hat{j’}+(1-\\sqrt{3})\\hat{k’}\\)","\\((1-\\sqrt{3})\\hat{i’}+(3+\\sqrt{3})\\hat{j’}+2\\hat{k’}\\)","\\((1-\\sqrt{3})\\hat{i’}+(3-\\sqrt{3})\\hat{j’}+2\\hat{k’}\\)"], 
    answer: 0 
    },
    { q: "Four forces are given below in cartesian and spherical polar coordinates\\((i) \\vec{F_{1}}=kexp(frac{-r^2}{R^2})\\hat{r}\\), \\((ii) \\vec{F_{2}}=k(x^3\\hat{y}-y^3\\hat{z})\\), \\((iii) \\vec{F_{3}}=k(x^3\\hat{x}-y^3\\hat{y})\\), \\((iv) \\vec{F_{4}}=kexp(frac{\\phi}{r})\\)", 
    options: ["(iii) and (iv) are conservative but (i) and (ii) are not","(i) and (ii) are conservative but (iii) and (iv) are not","(ii) and (iii) are conservative but (i) and (iv) are not","(i) and (iii) are conservative but (ii) and (iv) are not"], 
    answer: 3 
    },
    { q: `Given that the magnetic flux through closed loop PQRS in \\(‘\\phi’\\) of \\(int_{p}^{R}\\vec{A}\\cdot\\vec{dl}=\\phi_{1}\\), along PQR, the value of  \\(int_{p}^{R}\\vec{A}\\cdot\\vec{dl}\\) along PSR is <figure><img src="set_4_qn_2.png" alt="graph"width="300"><figure>`, 
    options: ["\\(\\phi - \\phi_{1}\\)","\\(\\phi_{1}- \\phi\\)","\\(-\\phi_{1}\\)","\\(\\phi_{1}\\)"], 
    answer: 1 
    }, 
    { q: "In spherical polar coordinates system \\((r, \\theta, \\phi)\\) the unit vector \\(\\hat{\\theta}\\) at \\(10, \\pi/4, \\pi/2\\) is", 
    options: ["\\(\\hat{k}\\)","\\(1/\\sqrt{2}(\\hat{j}+\\hat{k})\\)","\\(1/\\sqrt{2}(\\hat{-j}+\\hat{k})\\)","\\(1/\\sqrt{2}(\\hat{j}-\\hat{k})\\)"], 
    answer: 3
    },
    { q: "During a rotation, the vector along the axis of rotation remains unchanged. For the rotation matrix \\(\\begin{bmatrix} 0&1&0 \\\\ 0&0&-1 \\\\ -1&0&0 \\end{bmatrix}\\)the unit vector along the axis of rotation is ", 
    options: ["\\(\\frac{1}{3}(2\\hat{i}-\\hat{j}+2\\hat{k})\\)","\\(\\frac{1}{\\sqrt{3}}(\\hat{i}+\\hat{j}-\\hat{k})\\)","\\(\\frac{1}{\\sqrt{3}}(\\hat{i}-\\hat{j}-\\hat{k})\\)","\\(\\frac{1}{\\sqrt{3}}(2\\hat{i}+2\\hat{j}-\\hat{k})\\)"], 
    answer: 1 
    },
    { q: "Find the volume of the parallelopiped with adjacent sides \\(\\vec{OA}=3\\hat{i}-\\hat{j}\\), \\(\\vec{OC}= \\hat{i}+5\\hat{j}+4\\hat{k}\\), and \\(\\vec{OB}=\\hat{j}+2\\hat{k}\\) extending from the origin of co-ordinates O", 
    options: ["20","10","-20","-10"], 
    answer: 2 
    },
    { q: "The equation of surface of revolution is \\(z = \\pm\\sqrt{3/2 x^{2}+3/2 y^{2}}\\) The unit normal to surface at point A \\((\\sqrt{2/3},0,1)\\) is,", 
    options: ["\\(\\sqrt{\\frac{3}{5}}\\hat{i}+\\frac{2}{\\sqrt{10}}\\hat{k}\\)","\\(\\sqrt{\\frac{3}{5}}\\hat{i}-\\frac{2}{\\sqrt{10}}\\hat{k}\\)","\\(\\sqrt{\\frac{3}{5}}\\hat{i}+\\frac{2}{\\sqrt{5}}\\hat{k}\\)","\\(\\sqrt{\\frac{3}{10}}\\hat{i}+\\frac{2}{\\sqrt{10}}\\hat{k}\\)"], 
    answer: 1 
    },
    { q: `The Line integral \\(\\int_{A}^{B}\\vec{F}\\cdot\\vec{dl}\\), where \\(\\vec{F}= \\frac{x}{\\sqrt{x^2+y^2}}\\hat{x}+\\frac{y}{\\sqrt{x^2+y^2}}\\hat{y}\\) along the  semicircular path as shown in the figure below is <figure><img src="set_4_qn_20.png" alt=" graph"width="300"><figure>`, 
    options: ["-1","0","1","2"], 
    answer: 1 
    }, 
    


    // ... (add or keep the rest of questions as in your original file)
    // For brevity I include the main ones; keep the whole array you had originally here.
  ];

  // If you kept all questions, they will be shuffled below
  questionsArray = shuffleArray(questionsArray);

  // Shuffle options but keep correct mapping
  questionsArray.forEach(q=>{
    const correctValue = q.options[q.answer];
    q.options = shuffleArray(q.options.slice());
    q.answer = q.options.indexOf(correctValue);
  });

  // ========== Create elements dynamically ==========
  const examDiv = document.getElementById('exam');
  const questionsRoot = document.getElementById('questions-root');
  const paletteRoot = document.getElementById('palette-root');
  const totalQSpan = document.getElementById('total-q');

  // create question nodes
  questionsArray.forEach((item,index)=>{
    const qDiv = document.createElement('div');
    qDiv.classList.add('question');
    qDiv.id = `q${index+1}`;
    qDiv.style.display = 'none'; // hidden initially
    

    // question text
    const p = document.createElement('div');
    p.style.marginBottom = '10px';
    p.innerHTML = `<div style="font-weight:600; margin-bottom:6px;">${index+1}. </div> <div>${item.q}</div>`;
    qDiv.appendChild(p);

    // options container
    const optionsDiv = document.createElement('div');
    optionsDiv.classList.add('options');

    item.options.forEach((opt,i)=>{
      // IMPORTANT: put input and a span so we can style input:checked + span
      const label = document.createElement('label');
      label.htmlFor = `q${index+1}_opt${i}`;

      const input = document.createElement('input');
      input.type = 'radio';
      input.name = `q${index+1}`;
      input.id = `q${index+1}_opt${i}`;
      input.value = i;

      const span = document.createElement('span');
      span.className = 'opt-text';
      span.innerHTML = opt;

      // append to label: input then span
      label.appendChild(input);
      label.appendChild(span);

      optionsDiv.appendChild(label);
    });

    qDiv.appendChild(optionsDiv);
    questionsRoot.appendChild(qDiv);

    // palette button
    const pal = document.createElement('button');
    pal.className = 'pal-btn';
    pal.innerText = index+1;
    pal.dataset.index = index;
    pal.addEventListener('click', ()=>{ showQuestion(index); });
    paletteRoot.appendChild(pal);
  });
  renderMath();

  totalQSpan.innerText = questionsArray.length;

  // ========== State and helpers ==========
  let current = 0;
  const questions = document.querySelectorAll('.question');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const submitBtn = document.getElementById('submit-btn');
  const saveNextBtn = document.getElementById('save-next');
  const paletteButtons = document.querySelectorAll('.pal-btn');
  const progressBar = document.getElementById('progress-bar');
  const progressText = document.getElementById('progress-text');
  const timerVal = document.getElementById('timer-val');
  const timerSmall = document.getElementById('timer-small');
  const headerExamTitle = document.getElementById('header-exam-title');
  const studentInfoP = document.getElementById('student-info');

  function showQuestion(index){
    // bounds
    if(index < 0) index = 0;
    if(index >= questions.length) index = questions.length - 1;
    current = index;
    questions.forEach((q,i)=>{
      q.style.display = (i===index)?'block':'none';
    });
    // update palette visuals
    document.querySelectorAll('.pal-btn').forEach((b,i)=>{
      b.classList.toggle('current', i===index);
      // answered?
      const sel = document.querySelector(`#q${i+1} input[type="radio"]:checked`);
      b.classList.toggle('answered', !!sel);
    });
    // update meta
    document.getElementById('q-num').innerText = `Q${index+1}`;
    // update progress
    updateProgress();
    // typeset math
    MathJax.typesetPromise();
    // scroll left card to top
    document.getElementById('left-card').scrollIntoView({behavior:'smooth', block:'start'});
    
  }
  


  function updateProgress(){
    const answered = [...questions].filter((q,i)=> q.querySelector('input[type="radio"]:checked')).length;
    const total = questions.length;
    const percent = Math.round((answered/total)*100);
    progressBar.style.width = percent + '%';
    progressText.innerText = `${answered} / ${total}`;
  }

  prevBtn.addEventListener('click', ()=>{ if(current>0) showQuestion(current-1); });
  nextBtn.addEventListener('click', ()=>{ if(current<questions.length-1) showQuestion(current+1); });

  // Save & Next: just move to next after ensuring one selection preserved
  saveNextBtn.addEventListener('click', ()=>{
    // nothing extra here; selections persist
    if(current < questions.length - 1) showQuestion(current+1);
  });

  // Submit handler
  submitBtn.addEventListener('click', submitExam);

  // ========== Timer (demo short duration, change as needed) ==========
  let countdown;
  function startTimer(seconds){
    let time = seconds;
    clearInterval(countdown);
    function tick(){
      if(time < 0){
        clearInterval(countdown);
        alert('Time finished. Submitting exam.');
        submitExam();
        return;
      }
      const m = Math.floor(time/60);
      const s = time % 60;
      timerVal.innerText = `${m}:${s < 10 ? '0'+s : s}`;
      timerSmall.innerText = `${m}:${s < 10 ? '0'+s : s}`;
      time--;
    }
    tick();
    countdown = setInterval(tick, 1000);
  }

  // ========== Start exam logic ==========
  const startBtn = document.getElementById('start-exam');
  const studentForm = document.getElementById('student-form');
  const examArea = document.getElementById('exam');
  const resultDiv = document.getElementById('result');
  startBtn.addEventListener('click', ()=>{
    const name = document.getElementById('student-name').value.trim();
    const email = document.getElementById('student-email').value.trim();
    const title = document.getElementById('exam-title').value.trim();
    if(!name){ alert('Name required'); return; }
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!email || !emailPattern.test(email)){ alert('Valid email required'); return; }
    if(!title){ alert('Exam title required'); return; }

    headerExamTitle.innerText = title;
    studentInfoP.innerHTML = `<strong>Name:</strong> ${name} | <strong>Email:</strong> ${email} | <strong>Exam:</strong> ${title}`;
    // show exam area
    studentForm.style.display = 'none';
    examArea.style.display = 'block';
    // show first question
    showQuestion(0);
    // start timer (set 1 minute for demo; change to desired seconds)
    document.getElementById('duration-text').innerText = '30 minutes';
    startTimer(30*60); // change 60 to desired total seconds, e.g., 3600 for 1 hour
  });


  // ========== Submit Exam Implementation ==========
  function submitExam(){
    clearInterval(countdown);
    // compute score
    let score = 0;
    const tbody = document.querySelector('#result-table tbody');
    tbody.innerHTML = '';
    questionsArray.forEach((item,index)=>{
      const qDiv = document.getElementById(`q${index+1}`);
      const selected = qDiv.querySelector('input[type="radio"]:checked');
      const userAnswer = selected ? parseInt(selected.value) : -1;
      const status = userAnswer === item.answer ? 'Correct' : 'Incorrect';
      if(status === 'Correct') score++;

      const userText = userAnswer === -1 ? 'Not Answered' : item.options[userAnswer];
      const correctText = item.options[item.answer];

      tbody.innerHTML += `<tr>
        <td style="max-width:300px; word-wrap:break-word;">${item.q}</td>
        <td>${userText}</td>
        <td>${correctText}</td>
        <td style="font-weight:700; color:${status==='Correct'?'#166534':'#b91c1c'}">${status}</td>
      </tr>`;
      // Rerender MathJax for the new content
      MathJax.typesetPromise([tbody]).catch((err) => console.error(err.message));
    });

    const pct = ((score / questionsArray.length) * 100).toFixed(2);
    let grade = '';
    if(pct >= 90) grade = 'A+';
    else if(pct >= 80) grade = 'A';
    else if(pct >= 70) grade = 'B';
    else if(pct >= 60) grade = 'C';
    else grade = 'F';

    document.getElementById('score-summary').innerText = `Score: ${score}/${questionsArray.length} | Percentage: ${pct}% | Grade: ${grade}`;

    // show result panel
    document.getElementById('result-table').style.display = 'table';
    examArea.style.display = 'none';
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({behavior:'smooth'});
  }

  // home button
  document.getElementById('home-btn').addEventListener('click', ()=>{
    // reload page to reset
    window.location.href = 'index.html'; // <-- link to your home page
  });

  // CSV download
  document.getElementById('download-csv').addEventListener('click', ()=>{
    let csv = 'Question,Your Answer,Correct Answer,Status\\n';
    questionsArray.forEach((item,index)=>{
      const qDiv = document.getElementById(`q${index+1}`);
      const selected = qDiv.querySelector('input[type="radio"]:checked');
      const userAnswer = selected ? item.options[parseInt(selected.value)] : 'Not Answered';
      const correctText = item.options[item.answer];
      const status = (userAnswer === correctText) ? 'Correct' : 'Incorrect';
      // simple escaping of commas
      csv += `"${item.q.replace(/"/g,'""')}","${userAnswer.replace(/"/g,'""')}","${correctText.replace(/"/g,'""')}","${status}"\\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'exam_results.csv'; a.click();
    URL.revokeObjectURL(url);
  });

  // initial progress update
  updateProgress();
  // ===== Step 5: Render Math =====
  if (window.MathJax) {
    MathJax.typesetPromise();
  }
}); // DOMContentLoaded
</script>

</body>
</html>



